# image2video — 产品需求文档 (PRD)
_版本: v0.4 • 最后更新: 2025-09-22_

## 1. 项目概述
image2video 是一款帮助创作者从手绘草图或参考图快速生成成品插画的 Web 工具。当前产品聚焦 **单张图片生成** 的创作体验，提供情感化的界面反馈与异步生成管线，面向个人创作者、短视频运营者以及需要快速出图的设计师。

> ⚠️ 本文档描述的是「已落地 / 正在实现」的需求。历史上的探索性方案已移入 `docs/archive/`。

## 2. 核心目标
1. 让用户在浏览器中完成草图绘制或上传，获得稳定可控的 AI 图片结果。
2. 提供友好的等待体验：生成过程有温暖提示、可查看状态。
3. 在成本可控的前提下，构建可扩展的后台队列和计费钩子，为后续商业化打基础。

## 3. 功能需求

### 3.1 Canvas & 素材管理
- **绘图工具**：铅笔、橡皮擦、画笔颜色/尺寸调节、图层显隐/锁定。
- **图片上传**：支持本地图片拖放或选择文件；可加载到画布继续编辑。
- **画布状态提示**：实时显示“空白/有内容”状态，提醒用户是否可以生成。
- **草图数据**：将画布导出成 Base64（原图、姿态图、遮罩图）供生成流程使用。

### 3.2 AI 生成流程
- **输入来源**：优先使用画布快照，引导用户绘制；若无草图，可直接上传图片作为参照。
- **生成模式**：单图图生图或文生图（通过提示词）。当前不支持连环画或视频。
- **异步队列**：将任务写入 Redis + BullMQ，避免阻塞 API。前端轮询资产状态。
- **状态提示**：生成开始、almost done、完成、失败时均提供情感化文案。
- **预算控制**：请求进入队列前通过 `BudgetGuardian` 检查月度配额，防止超额。

### 3.3 作品管理
- **项目**：系统自动创建默认项目，后续会开放项目列表/选择功能。
- **资产记录**：生成任务在 Postgres `assets` 表留存状态、耗时、错误信息，供轮询和审计。
- **通知**：利用全局通知栏提示上传成功、生成完成/失败，暂不提供邮件/消息推送。

### 3.4 未来阶段 (不在当前版本)
- 连环画批量生成、视频合成。
- 用户注册/登录、作品分享、社交渠道导出。
- 复杂的多工作区（贴纸等）之外的协作功能。
- 实时 WebSocket 通知、内容审核接入真实服务。

## 4. 体验与文案
- **情感化等待**：生成阶段循环展示三条暖心文案，失败时提供鼓励性提醒。
- **界面布局**：主画布 + 右侧素材/生成控制面板；贴纸工作区目前处于试验阶段，未对外开放。
- **可用性要求**：所有操作需在 1024px 宽屏下工作；适配移动端属于后续计划。

## 5. 非功能需求
- **性能**：单次生成预估 30 秒内完成；接口需具备错误重试能力。
- **成本**：默认按 ¥0.07 / 图计费，写入 `billing_events`；真实扣费逻辑尚未启用。
- **安全/合规**：目前使用模拟内容审核；需在未来版本替换为真实服务（Google Vision 等）。
- **可观察性**：队列 & 生成流程在日志中打点（开始、审核、上传），便于排障。

## 6. 依赖与环境
- **AI 模型**：nano-banana API（图生图/文生图）。
- **基础设施**：Next.js App Router、PostgreSQL、MongoDB、Redis、AWS S3。
- **运行要求**：提供 `.env.local`（详见根目录 README）并独立启动 Worker（`npm run worker`）。

## 7. 里程碑
| 阶段 | 目标 | 状态 |
| --- | --- | --- |
| v0.3 (当前) | 单图生成、队列、预算守卫、情感化文案 | ✅ 交付完成 |
| v0.4 | 作品集 UI、贴纸工作区巩固、内容审核真实接入 | 🚧 进行中 |
| v0.5+ | 连环画/视频、账号体系、导出分享 | ⏳ 未排期 |

---
_Owner: Product (Zihao) • 下次复审: 2025-10-15_
