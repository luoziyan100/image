# ç¬¬ä¸€æ¬¡å¯¹è¯è®°å½• - image2videoé¡¹ç›®

**å¯¹è¯æ—¶é—´**: 2025-08-31  
**ä¸Šä¸‹æ–‡çª—å£**: å·²ä½¿ç”¨91%ï¼Œéœ€è¦ä¼ æ‰¿è®°å¿†

---

## é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒå®šä½
AIé©±åŠ¨çš„åˆ›æ„å·¥å…·ï¼Œç”¨æˆ·é€šè¿‡æ‰‹ç»˜è‰å›¾ç»“åˆAIç”Ÿæˆç²¾ç¾çš„è¿ç¯ç”»ä½œå“ã€‚æ”¯æŒå•å›¾å’Œè¿ç¯ç”»ä¸¤ç§æ¨¡å¼ï¼Œå¯é€‰è§†é¢‘åˆæˆã€‚

### ç›®æ ‡ç”¨æˆ·
- **ä¸ªäººåˆ›ä½œè€…**: æ¼«ç”»çˆ±å¥½è€…ã€æ’ç”»å®¶ã€å†…å®¹åˆ›ä½œè€…  
- **ç”µå•†å•†å®¶**: éœ€è¦äº§å“å±•ç¤ºå›¾ã€å¹¿å‘Šç´ æçš„å•†å®¶

### æŠ€æœ¯æ„¿æ™¯
è®©æ¯ä¸ªäººéƒ½èƒ½è½»æ¾åˆ›ä½œå‡ºä¸“ä¸šçº§çš„è§†è§‰å†…å®¹ï¼Œé€šè¿‡AIæŠ€æœ¯æ”¾å¤§åˆ›æ„æ½œåŠ›ã€‚

---

## å®Œæ•´æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆé€‰æ‹©
```
å‰ç«¯: React + Next.js + Fabric.js + TailwindCSS + TypeScript
åç«¯: Node.js + Next.js API Routes  
æ•°æ®åº“: PostgreSQL (å…ƒæ•°æ®) + MongoDB (è‰å›¾JSON) + Redis (é˜Ÿåˆ—/ç¼“å­˜)
AIæœåŠ¡: nano-banana API + Google Cloud Vision (å®¡æ ¸)
å­˜å‚¨: AWS S3 + CDN
éƒ¨ç½²: Vercel (å‰ç«¯) + AWS Fargate (Worker)
çŠ¶æ€ç®¡ç†: Zustand
ä»»åŠ¡é˜Ÿåˆ—: BullMQ
```

### æ ¸å¿ƒæ¶æ„æµç¨‹
```
ç”¨æˆ·ç»˜å›¾ â†’ APIæ”¶åˆ°è¯·æ±‚ â†’ åˆ›å»ºassetè®°å½• â†’ æ¨é€ä»»åŠ¡åˆ°Redisé˜Ÿåˆ— 
                                                    â†“
Workerå¤„ç†: è¾“å…¥å®¡æ ¸ â†’ AIç”Ÿæˆ â†’ è¾“å‡ºå®¡æ ¸ â†’ ä¸Šä¼ S3 â†’ æ›´æ–°çŠ¶æ€ â†’ é€šçŸ¥ç”¨æˆ·
```

### æ•°æ®åº“è®¾è®¡

**PostgreSQLæ ¸å¿ƒè¡¨**:
```sql
users (id UUID, email, password_hash, plan_type, created_at)
projects (id UUID, user_id, title, project_type, status, created_at) 
assets (id UUID, project_id, source_sketch_id, storage_url, status, error_code, position_in_project)
usage_stats (month_year, total_cost_cents, total_api_calls, updated_at)
billing_events (asset_id, user_id, cost_cents, status, created_at)
```

**MongoDBé›†åˆ**:
```json
sketches {
  _id: ObjectId,
  user_id: "uuid",
  project_id: "uuid", 
  fabric_json: { /* Fabric.jsç”»å¸ƒæ•°æ® */ },
  created_at: ISODate
}
```

---

## å…³é”®æŠ€æœ¯å†³ç­–

### 1. æ•°æ®ä¸€è‡´æ€§ - Sagaæ¨¡å¼
```javascript
// è§£å†³PostgreSQL + MongoDBåŒæ•°æ®åº“ä¸€è‡´æ€§
try {
  const project = await createProjectInPg(data);    // Step 1
  await createSketchInMongo(data, projectId);       // Step 2  
} catch (error) {
  if (projectId) await deleteProjectInPg(projectId); // è¡¥å¿äº‹åŠ¡
}
```

### 2. AIæ¨¡å‹é›†æˆ - nano-banana API
```javascript
// RESTfulæ¥å£ï¼Œæ¯å¼ å›¾Â¥0.039ï¼Œæœˆé¢„ç®—Â¥10,000
const response = await fetch('https://api.nanobanana.ai/v1/generate', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${apiKey}` },
  body: JSON.stringify({
    prompt,
    quality: 'high',
    aspect_ratio: '1:1',
    response_format: 'b64_json'
  })
});
```

### 3. è¿ç¯ç”»ä¸€è‡´æ€§ç­–ç•¥
**Phase 1**: æç¤ºè¯å·¥ç¨‹ï¼ˆè§’è‰²åç§°+ç‰¹å¾æè¿°ï¼‰  
**Phase 2**: Seedå›ºå®š + å›¾ç”Ÿå›¾æ¨¡å¼ï¼Œä¿æŒè§’è‰²å’Œé£æ ¼ä¸€è‡´

### 4. æˆæœ¬æ§åˆ¶æœºåˆ¶
- **é¢„ç®—æ£€æŸ¥**: APIä¸­é—´ä»¶æ£€æŸ¥monthly usage < Â¥10,000
- **ç”¨æˆ·é™æµ**: å…è´¹ç”¨æˆ·5æ¬¡/åˆ†é’Ÿï¼Œä»˜è´¹ç”¨æˆ·25æ¬¡/åˆ†é’Ÿ
- **ç³»ç»Ÿé™æµ**: Workerå…¨å±€é™åˆ¶5 QPSè°ƒç”¨AI API  
- **äº‹åŠ¡æ—¥å¿—**: billing_eventsè¡¨è®°å½•æ¯æ¬¡è°ƒç”¨ï¼Œç‹¬ç«‹Workerç»Ÿè®¡

### 5. å®æ—¶é€šçŸ¥æ–¹æ¡ˆ
- **MVP**: çŸ­è½®è¯¢ï¼Œ3ç§’é—´éš”æŸ¥è¯¢assetçŠ¶æ€
- **ç”Ÿäº§**: Pusher WebSocketæ¨é€çŠ¶æ€æ›´æ–°

### 6. å†…å®¹å®¡æ ¸åŒé‡æœºåˆ¶
```
è¾“å…¥å®¡æ ¸: ç”¨æˆ·è‰å›¾ â†’ Google Vision API â†’ é€šè¿‡/æ‹’ç»
è¾“å‡ºå®¡æ ¸: AIç”Ÿæˆå›¾ â†’ Google Vision API â†’ å‘å¸ƒ/æ‹’ç»
```

---

## UI/UXè®¾è®¡æ–¹æ¡ˆ

### é€‰å®šå¸ƒå±€ - æ–¹æ¡ˆäºŒï¼šç°ä»£Webåº”ç”¨
```
â”Œâ”€ é¡¶éƒ¨å¯¼èˆª: Logo + ç”¨æˆ·ä¿¡æ¯ + é¢„ç®—æ˜¾ç¤º â”€â”
â”œâ”€ å·¥å…·æ : ç»˜åˆ¶å·¥å…· + é¢œè‰² + å¤§å° â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”œâ”€ ä¸»ç”»å¸ƒ: 1024x1024ç»˜å›¾åŒºåŸŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€ æ“ä½œæ : ä¿å­˜è‰ç¨¿ + AIç”Ÿæˆ + åˆ†äº« â”€â”€â”€â”€â”€â”€â”¤
â””â”€ é¡¹ç›®åº“: æœ€æ–°ä½œå“å±•ç¤ºå’Œç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶æ¶æ„
- **Toolbar**: å·¥å…·åˆ‡æ¢å’Œå‚æ•°æ§åˆ¶
- **Canvas**: Fabric.jsç”»å¸ƒé›†æˆï¼Œæ”¯æŒåŒè¾“å…¥æ¨¡å¼
- **GenerationProgress**: å®æ—¶è¿›åº¦å±•ç¤ºå’ŒçŠ¶æ€é€šçŸ¥  
- **ProjectGallery**: ä½œå“ç®¡ç†å’Œå±•ç¤º
- **AutoSaveManager**: 30ç§’å®šæ—¶+5æ¬¡ä¿®æ”¹è§¦å‘ä¿å­˜

### äº¤äº’çŠ¶æ€ç®¡ç†
ä½¿ç”¨Zustandè¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†ï¼ŒåŒ…å«ï¼š
- ç”¨æˆ·çŠ¶æ€ã€é¡¹ç›®çŠ¶æ€ã€ç”»å¸ƒçŠ¶æ€ã€ç”ŸæˆçŠ¶æ€ã€UIçŠ¶æ€ã€é¢„ç®—çŠ¶æ€

---

## å¼€å‘ç¯å¢ƒé…ç½®

### æ··åˆæ¶æ„ç­–ç•¥
- **å‰ç«¯å¼€å‘**: Node.jsæœ¬åœ°ç¯å¢ƒï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
- **æ•°æ®åº“**: Docker Composeï¼ˆç¯å¢ƒéš”ç¦»ï¼‰  
- **ç”Ÿäº§éƒ¨ç½²**: å…¨å®¹å™¨åŒ–

### å·²å®Œæˆé…ç½®
1. âœ… Next.jsé¡¹ç›®åˆ›å»ºï¼ˆTypeScript + TailwindCSSï¼‰
2. âœ… Docker Composeæ•°æ®åº“æœåŠ¡å¯åŠ¨
   - PostgreSQL: localhost:5432  
   - MongoDB: localhost:27017
   - Redis: localhost:6379
3. âœ… æ ¸å¿ƒä¾èµ–åŒ…å®‰è£…
4. âœ… ç›®å½•ç»“æ„åˆ›å»º
5. âœ… åŸºç¡€é…ç½®æ–‡ä»¶ï¼ˆ.env.local, types, db.ts, store.ts, api-client.tsï¼‰

### å½“å‰çŠ¶æ€
- æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆå†…å­˜å ç”¨~120MBï¼‰
- é¡¹ç›®æ¡†æ¶æ­å»ºå®Œæˆ
- å‡†å¤‡åˆ›å»ºæ ¸å¿ƒç»„ä»¶

---

## å…³é”®æŠ€æœ¯ç–‘é—®è®°å½•

### ğŸ”´ é«˜ä¼˜å…ˆçº§å¾…è§£å†³
1. **è¿ç¯ç”»ä¸€è‡´æ€§**: AIæ¦‚ç‡æ€§ vs å•†ä¸šå¯é æ€§éœ€æ±‚
2. **æˆæœ¬é»‘å¤©é¹…**: APIæ¶¨ä»·/æ¶æ„åˆ·é‡åº”å¯¹ç­–ç•¥
3. **æ•°æ®ä¸€è‡´æ€§**: Sagaæ¨¡å¼é«˜å¹¶å‘ä¸‹çš„å¹½çµè¯»å–é—®é¢˜

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§  
4. **é”™è¯¯æ¢å¤**: ç”¨æˆ·å‹å¥½çš„å¤±è´¥å¤„ç†æµç¨‹
5. **æ¨¡å‹åˆ‡æ¢**: å¤šAIæ¨¡å‹æŠ½è±¡å±‚è®¾è®¡

### æŠ€æœ¯å€ºåŠ¡
- åŠ¨æ€å®šä»·ç­–ç•¥
- æœåŠ¡é™çº§æœºåˆ¶
- ä¸€è‡´æ€§è¯„åˆ†AIæ¨¡å‹  
- è·¨åœ°åŸŸæ•°æ®åŒæ­¥

---

## å¼€å‘è·¯çº¿å›¾

### Phase 1: MVPåŸºç¡€æ¶æ„ (4-6å‘¨)
- Week 1-2: é¡¹ç›®åˆå§‹åŒ– + æ•°æ®åº“ + è®¤è¯ç³»ç»Ÿ
- Week 3-4: Fabric.jsç”»å¸ƒ + åŒè¾“å…¥æ¨¡å¼ + è‡ªåŠ¨ä¿å­˜  
- Week 5-6: AIç”Ÿæˆæµç¨‹ + å¼‚æ­¥é˜Ÿåˆ— + å†…å®¹å®¡æ ¸

### Phase 2: ç”¨æˆ·ä½“éªŒ (3-4å‘¨)  
- Week 7-8: å®æ—¶é€šçŸ¥ + çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- Week 9-10: æˆæœ¬æ§åˆ¶ + é™æµ + ç›‘æ§

### Phase 3: é«˜çº§åŠŸèƒ½ (4-5å‘¨)
- Week 11-12: è¿ç¯ç”»æ¨¡å¼ + ä¸€è‡´æ€§ç®¡ç†
- Week 13-15: è§†é¢‘åˆæˆåŠŸèƒ½

### Phase 4: ç”Ÿäº§å°±ç»ª (2-3å‘¨)
- Week 16-17: æ€§èƒ½ä¼˜åŒ– + å®‰å…¨åŠ å›º  
- Week 18: éƒ¨ç½² + ç›‘æ§

---

## é‡è¦æ–‡æ¡£ä½ç½®
- **PRD**: `/docs/PRD.md`  
- **æŠ€æœ¯æ¶æ„**: `/docs/Technical-Architecture.md`
- **UIè®¾è®¡**: `/docs/UI-UX-Design.md`
- **é¡¹ç›®è®°å¿†**: `/CLAUDE.md`

---

## ä¸‹æ¬¡å¯¹è¯ç»§ç»­ç‚¹

**å½“å‰è¿›åº¦**: é¡¹ç›®åŸºç¡€æ¶æ„å·²æ­å»ºå®Œæˆï¼Œæ•°æ®åº“æœåŠ¡è¿è¡Œæ­£å¸¸

**ä¸‹ä¸€æ­¥ä»»åŠ¡**:
1. åˆ›å»ºæ ¸å¿ƒReactç»„ä»¶ï¼ˆToolbar, Canvas, GenerationProgressï¼‰
2. å®ç°APIè·¯ç”±ï¼ˆè®¤è¯ã€é¡¹ç›®ç®¡ç†ã€ç”Ÿæˆï¼‰
3. é›†æˆFabric.jsç”»å¸ƒåŠŸèƒ½
4. è¿æ¥æ•°æ®åº“å¹¶æµ‹è¯•åŸºç¡€æµç¨‹

**ç¯å¢ƒå‡†å¤‡**:
```bash
# å¯åŠ¨æ•°æ®åº“
docker-compose up -d

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨  
npm run dev

# è®¿é—®: http://localhost:3000
```

**ä»£ç ä½ç½®**: `/Users/zihao/image2video`

---

**è‡´è°¢**: è¿™æ˜¯ä¸€æ¬¡æ·±åº¦çš„æ¶æ„è®¾è®¡å¯¹è¯ï¼Œä»PRDåˆ°æŠ€æœ¯æ–¹æ¡ˆåˆ°UIè®¾è®¡ï¼Œå»ºç«‹äº†å®Œæ•´çš„æŠ€æœ¯ä½“ç³»ã€‚é¡¹ç›®å·²å…·å¤‡å¼€å‘çš„æ‰€æœ‰åŸºç¡€æ¡ä»¶ã€‚

**è®°å½•å®Œæ¯•** âœ…